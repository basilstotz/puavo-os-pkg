#!/bin/sh

set -eu

command=$1
shift

ktpdir='/opt/abitti-ktpapi'

case "${command}" in
  configure)
    upstream_dir=$1
    mkdir -p "$ktpdir"
    for install_script in ${upstream_dir}/jonilehtola-ktpapi-*/dist/*; do
      ln -fns "$install_script" "$ktpdir"
    done
    ;;
  unconfigure)
    rm -rf "$ktpdir"
    ;;
  unpack)
    upstream_pack=$1
    upstream_dir=$2

    tar --no-same-owner -z -x -f "$upstream_pack" -C "$upstream_dir"
    (
      cd ${upstream_dir}/jonilehtola-ktpapi-*
      make
    )
    ;;
  *)
    ;;
esac
